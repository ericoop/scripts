var http = require("http"),
url = require("url"),

function execCmd(req, res, shFile, tip) {
  var spawn = require('child_process').spawn;
  var cmd = spawn("/bin/sh", [shFile]);
  res.writeHead(200, {"Content-Type": "text/plain; charset=UTF-8"});
  cmd.stdout.on("data", function (chunk) {
    res.write(chunk);
  });
  cmd.stderr.on("data", function (chunk) {
    res.write(chunk);
  });
  cmd.on('exit', function(code) {
    //console.log("end....");
    res.write(tip);
    res.end();
  });

}


function loadGame(req, res) {
  var spawn = require('child_process').spawn;
  var cmd = spawn("/bin/sh", ['loadGame.sh']);
  res.writeHead(200, {"Content-Type": "text/plain; charset=UTF-8"});
  cmd.stdout.on("data", function (chunk) {
    res.write(chunk);
  });
  cmd.stderr.on("data", function (chunk) {
    res.write(chunk);
  });
  cmd.on('exit', function(code) {
    console.log("end....");
    res.write("亲，数据已经加载并生效了!");
    res.end();
  });

}

function update(req, res) {
  var spawn = require('child_process').spawn;
  var cmd = spawn("/bin/sh", ['svnup.sh']);
  res.writeHead(200, {"Content-Type": "text/plain; charset=UTF-8"});
  cmd.stdout.on("data", function (chunk) {
    res.write(chunk);
  });
  cmd.stderr.on("data", function (chunk) {
    res.write(chunk);
  });
  cmd.on('exit', function(code) {
    console.log("end....");
    res.write("亲，dev代码已更新完毕!");
    res.end();
  });

}

http.createServer(function (req, res) {
  var uri = url.parse(req.url).pathname;
 
  switch(uri) {
    case '/load':
      loadGame(req, res);
      break;
    case '/update':
      update(req, res);
      break
    default:
     loadGame(req, res);
     break;
  } 
	
/*
        cmd1.stdout.addListener("data", function (chunk) {
                res.write(chunk);
        });
	cmd1.stderr.addListener("data", function (chunk) {
                res.write(chunk);
        });
*/	
}).listen(8080);
